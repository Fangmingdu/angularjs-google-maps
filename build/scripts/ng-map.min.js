var ngMap=angular.module("ngMap",[]);ngMap.service("Attr2Options",["$parse","NavigatorGeolocation","GeoCoder",function($parse,NavigatorGeolocation,GeoCoder){var SPECIAL_CHARS_REGEXP=/([\:\-\_]+(.))/g,MOZ_HACK_REGEXP=/^moz([A-Z])/,orgAttributes=function(e){e.length>0&&(e=e[0]);for(var t={},n=0;n<e.attributes.length;n++){var o=e.attributes[n];t[o.name]=o.value}return t},camelCase=function(e){return e.replace(SPECIAL_CHARS_REGEXP,function(e,t,n,o){return o?n.toUpperCase():n}).replace(MOZ_HACK_REGEXP,"Moz$1")},JSONize=function(e){try{return JSON.parse(e),e}catch(t){return e.replace(/([\$\w]+)\s*:/g,function(e,t){return'"'+t+'":'}).replace(/'([^']+)'/g,function(e,t){return'"'+t+'"'})}},toOptionValue=function(input,options){var output,key=options.key,scope=options.scope;try{var num=Number(input);if(isNaN(num))throw"Not a number";output=num}catch(err){try{if(input.match(/^[\+\-]?[0-9\.]+,[ ]*\ ?[\+\-]?[0-9\.]+$/)&&(input="["+input+"]"),output=JSON.parse(JSONize(input)),output instanceof Array){var t1stEl=output[0];if(t1stEl.constructor==Object);else if(t1stEl.constructor==Array)output=output.map(function(e){return new google.maps.LatLng(e[0],e[1])});else if(!isNaN(parseFloat(t1stEl))&&isFinite(t1stEl))return new google.maps.LatLng(output[0],output[1])}}catch(err2){if(input.match(/^[A-Z][a-zA-Z0-9]+\(.*\)$/))try{var exp="new google.maps."+input;output=eval(exp)}catch(e){output=input}else if(input.match(/^([A-Z][a-zA-Z0-9]+)\.([A-Z]+)$/))try{var matches=input.match(/^([A-Z][a-zA-Z0-9]+)\.([A-Z]+)$/);output=google.maps[matches[1]][matches[2]]}catch(e){output=input}else if(input.match(/^[A-Z]+$/))try{var capitalizedKey=key.charAt(0).toUpperCase()+key.slice(1);key.match(/temperatureUnit|windSpeedUnit|labelColor/)?(capitalizedKey=capitalizedKey.replace(/s$/,""),output=google.maps.weather[capitalizedKey][input]):output=google.maps[capitalizedKey][input]}catch(e){output=input}else output=input}}return output},setDelayedGeoLocation=function(e,t,n,o){o=o||{};var r=e.centered||o.centered,i=function(){var n=o.fallbackLocation||new google.maps.LatLng(0,0);e[t](n)};!n||n.match(/^current/i)?NavigatorGeolocation.getCurrentPosition().then(function(n){var i=n.coords.latitude,a=n.coords.longitude,s=new google.maps.LatLng(i,a);e[t](s),r&&e.map.setCenter(s),o.callback&&o.callback.apply(e)},i):GeoCoder.geocode({address:n}).then(function(n){e[t](n[0].geometry.location),r&&e.map.setCenter(n[0].geometry.location)},i)},getAttrsToObserve=function(e){var t=[];if(e["ng-repeat"]||e.ngRepeat);else for(var n in e){var o=e[n];o&&o.match(/\{\{.*\}\}/)&&t.push(camelCase(n))}return t},observeAttrSetObj=function(e,t,n){var o=getAttrsToObserve(e);Object.keys(o).length;for(var r=0;r<o.length;r++)observeAndSet(t,o[r],n)},observeAndSet=function(e,t,n){e.$observe(t,function(e){if(e){var o=camelCase("set-"+t),r=toOptionValue(e,{key:t});n[o]&&(t.match(/center|position/)&&"string"==typeof r?setDelayedGeoLocation(n,o,r):n[o](r))}})};return{filter:function(e){var t={};for(var n in e)n.match(/^\$/)||n.match(/^ng[A-Z]/)||(t[n]=e[n]);return t},getOptions:function(e,t){var n={};for(var o in e)if(e[o]){if(o.match(/^on[A-Z]/))continue;if(o.match(/ControlOptions$/))continue;n[o]=toOptionValue(e[o],{scope:t,key:o})}return n},getEvents:function(e,t){var n={},o=function(e){return"_"+e.toLowerCase()},r=function(t){var n=t.match(/([^\(]+)\(([^\)]*)\)/),o=n[1],r=n[2].replace(/event[ ,]*/,""),i=e.$eval("["+r+"]");return function(t){function n(e,t){return e[t]}f=o.split(".").reduce(n,e),f.apply(this,[t].concat(i)),e.$apply()}};for(var i in t)if(t[i]){if(!i.match(/^on[A-Z]/))continue;var a=i.replace(/^on/,"");a=a.charAt(0).toLowerCase()+a.slice(1),a=a.replace(/([A-Z])/g,o);var s=t[i];n[a]=new r(s)}return n},getControlOptions:function(e){var t={};if("object"!=typeof e)return!1;for(var n in e)if(e[n]){if(!n.match(/(.*)ControlOptions$/))continue;var o=e[n],r=o.replace(/'/g,'"');r=r.replace(/([^"]+)|("[^"]+")/g,function(e,t,n){return t?t.replace(/([a-zA-Z0-9]+?):/g,'"$1":'):n});try{var i=JSON.parse(r);for(var a in i)if(i[a]){var s=i[a];if("string"==typeof s?s=s.toUpperCase():"mapTypeIds"===a&&(s=s.map(function(e){return e.match(/^[A-Z]+$/)?google.maps.MapTypeId[e.toUpperCase()]:e})),"style"===a){var p=n.charAt(0).toUpperCase()+n.slice(1),c=p.replace(/Options$/,"")+"Style";i[a]=google.maps[c][s]}else i[a]="position"===a?google.maps.ControlPosition[s]:s}t[n]=i}catch(l){}}return t},toOptionValue:toOptionValue,camelCase:camelCase,setDelayedGeoLocation:setDelayedGeoLocation,getAttrsToObserve:getAttrsToObserve,observeAndSet:observeAndSet,observeAttrSetObj:observeAttrSetObj,orgAttributes:orgAttributes}}]),ngMap.service("GeoCoder",["$q",function(e){return{geocode:function(t){var n=e.defer(),o=new google.maps.Geocoder;return o.geocode(t,function(e,t){t==google.maps.GeocoderStatus.OK?n.resolve(e):n.reject("Geocoder failed due to: "+t)}),n.promise}}}]),ngMap.service("NavigatorGeolocation",["$q",function(e){return{getCurrentPosition:function(){var t=e.defer();return navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){t.resolve(e)},function(e){t.reject(e)}):t.reject("Browser Geolocation service failed."),t.promise},watchPosition:function(){return"TODO"},clearWatch:function(){return"TODO"}}}]),ngMap.service("StreetView",["$q",function(e){return{getPanorama:function(t,n){n=n||t.getCenter();var o=e.defer(),r=new google.maps.StreetViewService;return r.getPanoramaByLocation(n||t.getCenter,100,function(e,t){t===google.maps.StreetViewStatus.OK?o.resolve(e.location.pano):o.resolve(!1)}),o.promise},setPanorama:function(e,t){var n=new google.maps.StreetViewPanorama(e.getDiv(),{enableCloseButton:!0});n.setPano(t)}}}]),ngMap.directive("bicyclingLayer",["Attr2Options",function(e){var t=e,n=function(e,t){var n=new google.maps.BicyclingLayer(e);for(var o in t)google.maps.event.addListener(n,o,t[o]);return n};return{restrict:"E",require:"^map",link:function(e,o,r,i){var a=t.orgAttributes(o),s=t.filter(r),p=t.getOptions(s),c=t.getEvents(e,s),l=n(p,c);i.addObject("bicyclingLayers",l),t.observeAttrSetObj(a,r,l)}}}]),ngMap.directive("cloudLayer",["Attr2Options",function(e){var t=e,n=function(e,t){var n=new google.maps.weather.CloudLayer(e);for(var o in t)google.maps.event.addListener(n,o,t[o]);return n};return{restrict:"E",require:"^map",link:function(e,o,r,i){var a=t.orgAttributes(o),s=t.filter(r),p=t.getOptions(s),c=t.getEvents(e,s),l=n(p,c);i.addObject("cloudLayers",l),t.observeAttrSetObj(a,r,l)}}}]),ngMap.directive("customControl",["Attr2Options","$compile",function(e,t){var n=e;return{restrict:"E",require:"^map",link:function(e,o,r,i){o.css("display","none");var a=(n.orgAttributes(o),n.filter(r)),s=n.getOptions(a,e),p=n.getEvents(e,a),c=t(o.html().trim())(e),l=c[0];for(var u in p)google.maps.event.addDomListener(l,u,p[u]);i.addObject("customControls",l),e.$on("mapInitialized",function(e,t){var n=s.position;t.controls[google.maps.ControlPosition[n]].push(l)})}}}]),d3.geo.tile=function(){function e(e,t){return Math.floor((e+180)/360*Math.pow(2,t))}function t(e,t){return Math.floor((1-Math.log(Math.tan(e*Math.PI/180)+1/Math.cos(e*Math.PI/180))/Math.PI)/2*Math.pow(2,t))}function n(){var n=256,a=[e(r.lng(),o),t(r.lat(),o)],s=[e(i.lng(),o),t(i.lat(),o)],p=[],c=d3.range(a[0],s[0]+1),l=d3.range(s[1],a[1]+1);return l.forEach(function(e){c.forEach(function(t){p.push([t,e,o])})}),p.scale=n,p.translate=[a[0],s[1]],p}var o=10,r=[0,0],i=[0,0];return n.zoom=function(e){return arguments.length?(o=e,n):o},n.sw=function(e){return arguments.length?(r=e,n):r},n.ne=function(e){return arguments.length?(i=e,n):i},n},ngMap.directive("d3TilesLayer",["Attr2Options","$window",function(e,t){function n(e,t,n){this.controller=e,this.id=t.id,this.options=t;var o=n;this.getScope=function(){return o},this.translate_x=0,this.translate_y=0}var o=e;return n.prototype=new google.maps.OverlayView,n.prototype.onAdd=function(){function e(e){var t=new google.maps.LatLng(e[1],e[0]),n=f.fromLatLngToDivPixel(t);return[n.x,n.y]}function o(e,t){if(Object.keys(d).length>0)if(t)t in d&&d[t].forEach(function(t){var n=e.markers[t];n&&(delete e.markers[t],n.setMap(null))}),delete d[t];else{for(var t in d)d[t].forEach(function(t){var n=e.markers[t];n&&(delete e.markers[t],n.setMap(null))});d={}}}function r(e,t,n){var o=n.iconwidth,r=n.iconheight,i={url:n.path+t,scaledSize:new google.maps.Size(o*m[e.getZoom()],r*m[e.getZoom()])};return i}function i(e){return 0===e||1===e||5===e||20===e||21===e||25===e?"Stabilized":3===e||4===e||23===e||24===e?"Lease Up":2===e||22===e?"Under Construction":6===e||26===e?"Planned":void 0}function a(e,t,n,o,a){var s={},p=[],c=g.markeroptions[a.id];n in d||(d[n]=[]),o.features.filter(function(e){return"Point"===e.geometry.type}).forEach(function(o){var l=o.properties[c.id];if(-1===d[n].indexOf(l)){d[n].push(l),p.push(l),s.position=new google.maps.LatLng(o.geometry.coordinates[1],o.geometry.coordinates[0]),s.id=l,s.icon=r(e,o.properties.picon,c),s.markerType=a.id,o.properties.lat=o.geometry.coordinates[1],o.properties.lng=o.geometry.coordinates[0],o.properties.occname=i(o.properties.occid),s.data=o.properties;var u=new google.maps.Marker(s);a.tooltip&&(google.maps.event.addListener(u,"mouseover",function(e){0!==u.getOpacity()&&v.$emit("markerMouseover",{position:f.fromLatLngToContainerPixel(e.latLng),latLng:e.latLng,marker:u,type:a.id})}),google.maps.event.addListener(u,"mouseout",function(e){0!==u.getOpacity()&&v.$emit("markerMouseout",{position:f.fromLatLngToContainerPixel(e.latLng),latLng:e.latLng,marker:u,type:a.id})})),google.maps.event.addListener(u,"click",function(){0!==u.getOpacity()&&v.$emit("markerClicked",{data:o.properties,marker:u})}),google.maps.event.addListener(u,"rightclick",function(e){0!==u.getOpacity()&&v.$emit("markerRightClicked",{position:f.fromLatLngToContainerPixel(e.latLng),latLng:e.latLng,id:o.properties[c.id],type:a.id,data:o.properties})}),t.addMarker(u)}}),v.$emit("markersLoaded",{id:a.id,markers:p})}function s(e,t,n,o,r,i){a(e,t,r,o,i)}function p(e,t){e.selectAll(t).each(function(){this._xhr&&this._xhr.length>0&&(this._xhr.forEach(function(e){e.abort()}),this._xhr=[])}),e.selectAll(t).remove()}function c(){var e=!1;return g.tileoptions.urls.forEach(function(t){t.visible&&(e=!0)}),e}function l(e,t,n,r,i){var a=h.zoom(e.getZoom()).sw(e.getBounds().getSouthWest()).ne(e.getBounds().getNorthEast())();i&&p(u,"g.tile");var l=u.selectAll("g.tile").data(a,function(e){return e});l.exit().each(function(t){this._xhr&&this._xhr.length>0&&(this._xhr.forEach(function(e){e.abort()}),this._xhr=[]);var n=t[0]+"-"+t[1]+"-"+t[2];o(e,n)}).remove(),c()&&(v.$emit("tiles.loaded.len",{len:l.data().length-l.data().filter(function(e){return!angular.isUndefined(e)}).length}),l.enter().append("g").attr("class","tile").each(function(n){var o=d3.select(this),r=[];this._xhr||(this._xhr=[]),g.tileoptions.urls.forEach(function(i){if(e.getZoom()>=i.zoom&&i.visible){var a=i.url+n[2]+"/"+n[0]+"/"+n[1]+"?pa="+i.pipeline,p=d3.json(a,function(r,a){r||void 0===a?401===r.status?v.$emit("unauthorized",{}):v.$emit("markersLoaded",{}):s(e,t,o,a,n[0]+"-"+n[1]+"-"+n[2],i)}).on("beforesend",function(e){e.withCredentials=!0});r.push(p)}}),this._xhr=r.length>0?r:[]}),l.attr("transform","translate("+n+","+r+")"))}{var u=d3.select(this.getPanes().overlayLayer).append("svg").style("width",t.innerWidth+"px").style("height",t.innerHeight+"px").style("position","absolute"),g=this.options,f=this.getProjection(),d={},m={10:.2,11:.3,12:.4,13:.6,14:.7,15:.8,16:1,17:1,18:1,19:1},v=this.getScope(),h=d3.geo.tile();d3.geo.path().projection(e)}n.prototype.clearMarkers=function(e){e&&o(e)},n.prototype.draw=function(e){l(this.map,this.controller,this.translate_x,this.translate_y,!!e)},n.prototype.dragged=function(){this.translate_x=-Math.round(this.getProjection().fromLatLngToDivPixel(this.map.getBounds().getSouthWest()).x),this.translate_y=-Math.round(this.getProjection().fromLatLngToDivPixel(this.map.getBounds().getNorthEast()).y),u.style("left",-this.translate_x+"px").style("top",-this.translate_y+"px"),l(this.map,this.controller,this.translate_x,this.translate_y)},n.prototype.project=function(e){return f.fromLatLngToContainerPixel(e)},n.prototype.toggleLayer=function(e,t){o(e),g.tileoptions.urls.forEach(function(e){e.visible=-1!==t.indexOf(e.id)?!0:!1}),l(e,this.controller,this.translate_x,this.translate_y,!0)},n.prototype.slideTime=function(e,t){o(e),g.tileoptions.urls.forEach(function(e){e.url=e.url.replace(/([0-9]+-)+[0-9]+/g,t)}),l(e,this.controller,this.translate_x,this.translate_y,!0)}},n.prototype.setTime=function(e){this.options.tileoptions.urls.forEach(function(t){t.url=t.url.replace(/([0-9]+-)+[0-9]+/g,e)})},n.prototype.setUrlDomain=function(e){this.options.tileoptions.urls.forEach(function(t){t.url=e+t.url})},n.prototype.setVisibleLayer=function(e){this.options.tileoptions.urls.forEach(function(t){t.visible=-1!==e.indexOf(t.id)?!0:!1})},n.prototype.setPipelineAccess=function(e){this.options.tileoptions.urls.forEach(function(t){t.pipeline=e[t.id]})},{restrict:"E",require:"^map",link:function(e,t,r,i){var a=(o.orgAttributes(t),o.filter(r)),s=o.getOptions(a),p=(o.getControlOptions(a),o.getEvents(e,a),new n(i,s,e));i.addObject("d3TilesLayers",p)}}}]),ngMap.directive("drawingManager",["Attr2Options",function(e){var t=e;return{restrict:"E",require:"^map",link:function(e,n,o,r){var i=(t.orgAttributes(n),t.filter(o)),a=t.getOptions(i),s=t.getControlOptions(i),p=t.getEvents(e,i),c=new google.maps.drawing.DrawingManager({drawingMode:a.drawingmode,drawingControl:a.drawingcontrol,drawingControlOptions:s.drawingControlOptions,circleOptions:a.circleoptions,markerOptions:a.markeroptions,polygonOptions:a.polygonoptions,polylineOptions:a.polylineoptions,rectangleOptions:a.rectangleoptions}),p=t.getEvents(e,i);for(var l in p)google.maps.event.addListener(c,l,p[l]);r.addObject("mapDrawingManager",c)}}}]),ngMap.directive("dynamicMapsEngineLayer",["Attr2Options",function(e){var t=e,n=function(e,t){var n=new google.maps.visualization.DynamicMapsEngineLayer(e);for(var o in t)google.maps.event.addListener(n,o,t[o]);return n};return{restrict:"E",require:"^map",link:function(e,o,r,i){var a=t.filter(r),s=t.getOptions(a),p=t.getEvents(e,a,p),c=n(s,p);i.addObject("mapsEngineLayers",c)}}}]),ngMap.directive("fusionTablesLayer",["Attr2Options",function(e){var t=e,n=function(e,t){var n=new google.maps.FusionTablesLayer(e);for(var o in t)google.maps.event.addListener(n,o,t[o]);return n};return{restrict:"E",require:"^map",link:function(e,o,r,i){var a=t.filter(r),s=t.getOptions(a),p=t.getEvents(e,a,p),c=n(s,p);i.addObject("fusionTablesLayers",c)}}}]),ngMap.directive("heatmapLayer",["Attr2Options","$window",function(e,t){var n=e;return{restrict:"E",require:"^map",link:function(e,o,r,i){var a=n.filter(r),s=n.getOptions(a);if(s.data=t[r.data]||e[r.data],!(s.data instanceof Array))throw"invalid heatmap data";s.data=new google.maps.MVCArray(s.data);{var p=new google.maps.visualization.HeatmapLayer(s);n.getEvents(e,a)}i.addObject("heatmapLayers",p)}}}]),ngMap.directive("infoWindow",["Attr2Options","$compile","$timeout",function(Attr2Options,$compile,$timeout){var parser=Attr2Options,getInfoWindow=function(options,events,element){var infoWindow;if(!options.position||options.position instanceof google.maps.LatLng)infoWindow=new google.maps.InfoWindow(options);else{var address=options.position;delete options.position,infoWindow=new google.maps.InfoWindow(options);var callback=function(){infoWindow.open(infoWindow.map)};parser.setDelayedGeoLocation(infoWindow,"setPosition",address,{callback:callback})}Object.keys(events).length>0;for(var eventName in events)eventName&&google.maps.event.addListener(infoWindow,eventName,events[eventName]);var template=element.html().trim();if(1!=angular.element(template).length)throw"info-window working as a template must have a container";return infoWindow.__template=template.replace(/\s?ng-non-bindable[='"]+/,""),infoWindow.__compile=function(e){var t=$compile(infoWindow.__template)(e);e.$apply(),infoWindow.setContent(t[0])},infoWindow.__eval=function(event){var template=infoWindow.__template,_this=this;return template=template.replace(/{{(event|this)[^;\}]+}}/g,function(match){var expression=match.replace(/[{}]/g,"").replace("this.","_this.");return eval(expression)})},infoWindow};return{restrict:"E",require:"^map",link:function(e,t,n,o){t.css("display","none");var r=parser.orgAttributes(t),i=parser.filter(n),a=parser.getOptions(i,e),s=parser.getEvents(e,i),p=getInfoWindow(a,s,t);o.addObject("infoWindows",p),parser.observeAttrSetObj(r,n,p),p.visible&&e.$on("mapInitialized",function(t,n){$timeout(function(){p.__template=p.__eval.apply(this,[t]),p.__compile(e),p.map=n,p.position&&p.open(n)})}),p.visibleOnMarker&&e.$on("mapInitialized",function(t,n){$timeout(function(){var o=p.visibleOnMarker,r=n.markers[o];if(!r)throw"Invalid marker id";p.__template=p.__eval.apply(this,[t]),p.__compile(e),p.open(n,r)})}),e.showInfoWindow=e.showInfoWindow||function(t,n,r){var i=o.map.infoWindows[n];i.__template=i.__eval.apply(this,[t]),i.__compile(e),r?i.open(o.map,r):this.getPosition?i.open(o.map,this):i.open(o.map)},e.hideInfoWindow=e.hideInfoWindow||function(t,n){var r=o.map.infoWindows[n];r.__template=r.__eval.apply(this,[t]),r.__compile(e),r.close()}}}}]),ngMap.directive("kmlLayer",["Attr2Options",function(e){var t=e,n=function(e,t){var n=new google.maps.KmlLayer(e);for(var o in t)google.maps.event.addListener(n,o,t[o]);return n};return{restrict:"E",require:"^map",link:function(e,o,r,i){var a=t.orgAttributes(o),s=t.filter(r),p=t.getOptions(s),c=t.getEvents(e,s),l=n(p,c);i.addObject("kmlLayers",l),t.observeAttrSetObj(a,r,l)}}}]),ngMap.directive("mapData",["Attr2Options",function(e){var t=e;return{restrict:"E",require:"^map",link:function(e,n,o){var r=t.filter(o),i=t.getOptions(r),a=t.getEvents(e,r,a);e.$on("mapInitialized",function(t,n){for(var o in i)if(o){var r=i[o];"function"==typeof e[r]?n.data[o](e[r]):n.data[o](r)}for(var s in a)a[s]&&n.data.addListener(s,a[s])})}}}]),ngMap.directive("mapType",["Attr2Options","$window",function(e,t){return{restrict:"E",require:"^map",link:function(e,n,o,r){var i,a=o.name;if(!a)throw"invalid map-type name";if(o.object){var s=e[o.object]?e:t;i=s[o.object],"function"==typeof i&&(i=new i)}if(!i)throw"invalid map-type object";e.$on("mapInitialized",function(e,t){t.mapTypes.set(a,i)}),r.addObject("mapTypes",i)}}}]),ngMap.directive("map",["Attr2Options","$timeout",function(e,t){function n(e,t){if(e.currentStyle)var n=e.currentStyle[t];else if(window.getComputedStyle)var n=document.defaultView.getComputedStyle(e,null).getPropertyValue(t);return n}var o=e;return{restrict:"AE",controller:ngMap.MapController,link:function(r,i,a,s){var p=o.orgAttributes(i);r.google=google;var c=document.createElement("div");c.style.width="100%",c.style.height="100%",i.prepend(c),"block"!=n(i[0],"display")&&i.css("display","block"),n(i[0],"height").match(/^(0|auto)/)&&i.css("height","300px");var l=function(n,i){var l=new google.maps.Map(c,{});l.markers={},l.shapes={},t(function(){google.maps.event.trigger(l,"resize")}),n.zoom=n.zoom||15;var u=n.center;u?u instanceof google.maps.LatLng||(delete n.center,e.setDelayedGeoLocation(l,"setCenter",u,{fallbackLocation:g.geoFallbackCenter})):n.center=new google.maps.LatLng(0,0),l.setOptions(n);for(var f in i)f&&google.maps.event.addListener(l,f,i[f]);o.observeAttrSetObj(p,a,l),s.map=l,s.addObjects(s._objects),r.map=l,r.map.scope=r,r.$emit("mapInitialized",l),r.maps=r.maps||{},r.maps[g.id||Object.keys(r.maps).length]=l,r.$emit("mapsInitialized",r.maps)},u=o.filter(a),g=o.getOptions(u,r),f=o.getControlOptions(u),d=angular.extend(g,f),m=o.getEvents(r,u);a.initEvent?r.$on(a.initEvent,function(){!s.map&&l(d,m)}):l(d,m)}}}]),ngMap.MapController=function(){this.map=null,this._objects=[],this.addMarker=function(e){if(this.map){this.map.markers=this.map.markers||{},e.setMap(this.map),e.centered&&this.map.setCenter(e.position);var t=Object.keys(this.map.markers).length;this.map.markers[e.id||t]=e}else this._objects.push(e)},this.addShape=function(e){if(this.map){this.map.shapes=this.map.shapes||{},e.setMap(this.map);var t=Object.keys(this.map.shapes).length;this.map.shapes[e.id||t]=e}else this._objects.push(e)},this.addObject=function(e,t){if(this.map){this.map[e]=this.map[e]||{};var n=Object.keys(this.map[e]).length;this.map[e][t.id||n]=t,"infoWindows"!=e&&t.setMap&&t.setMap(this.map)}else t.groupName=e,this._objects.push(t)},this.addObjects=function(e){for(var t=0;t<e.length;t++){var n=e[t];n instanceof google.maps.Marker?this.addMarker(n):n instanceof google.maps.Circle||n instanceof google.maps.Polygon||n instanceof google.maps.Polyline||n instanceof google.maps.Rectangle||n instanceof google.maps.GroundOverlay?this.addShape(n):this.addObject(n.groupName,n)}}},ngMap.directive("mapsEngineLayer",["Attr2Options",function(e){var t=e,n=function(e,t){var n=new google.maps.visualization.MapsEngineLayer(e);for(var o in t)google.maps.event.addListener(n,o,t[o]);return n};return{restrict:"E",require:"^map",link:function(e,o,r,i){var a=t.filter(r),s=t.getOptions(a),p=t.getEvents(e,a,p),c=n(s,p);i.addObject("mapsEngineLayers",c)}}}]),ngMap.directive("marker",["Attr2Options",function(e){var t=e,n=function(e,n){var o;if(e.icon instanceof Object){(""+e.icon.path).match(/^[A-Z_]+$/)&&(e.icon.path=google.maps.SymbolPath[e.icon.path]);for(var r in e.icon){var i=e.icon[r];"anchor"==r||"origin"==r?e.icon[r]=new google.maps.Point(i[0],i[1]):("size"==r||"scaledSize"==r)&&(e.icon[r]=new google.maps.Size(i[0],i[1]))}}if(e.position instanceof google.maps.LatLng)o=new google.maps.Marker(e);else{var a=e.position;e.position=new google.maps.LatLng(0,0),o=new google.maps.Marker(e),t.setDelayedGeoLocation(o,"setPosition",a)}Object.keys(n).length>0;for(var s in n)s&&google.maps.event.addListener(o,s,n[s]);return o};return{restrict:"E",require:"^map",link:function(e,o,r,i){var a=t.orgAttributes(o),s=t.filter(r),p=t.getOptions(s,e),c=t.getEvents(e,s);o.bind("$destroy",function(){var e=l.map.markers;for(var t in e)e[t]==l&&delete e[t];l.setMap(null)});var l=n(p,c);i.addMarker(l),t.observeAttrSetObj(a,r,l)}}}]),ngMap.directive("overlayMapType",["Attr2Options","$window",function(e,t){return{restrict:"E",require:"^map",link:function(e,n,o,r){var i,a=o.initMethod||"insertAt";if(o.object){var s=e[o.object]?e:t;i=s[o.object],"function"==typeof i&&(i=new i)}if(!i)throw"invalid map-type object";e.$on("mapInitialized",function(e,t){if("insertAt"==a){var n=parseInt(o.index,10);t.overlayMapTypes.insertAt(n,i)}else"push"==a&&t.overlayMapTypes.push(i)}),r.addObject("overlayMapTypes",i)}}}]),ngMap.directive("shape",["Attr2Options",function(e){var t=e,n=function(e){return new google.maps.LatLngBounds(e[0],e[1])},o=function(e,o){var r,i=e.name;if(delete e.name,e.icons)for(var a=0;a<e.icons.length;a++){var s=e.icons[a];s.icon.path.match(/^[A-Z_]+$/)&&(s.icon.path=google.maps.SymbolPath[s.icon.path])}switch(i){case"circle":if(e.center instanceof google.maps.LatLng)r=new google.maps.Circle(e);else{var p=e.center;e.center=new google.maps.LatLng(0,0),r=new google.maps.Circle(e),t.setDelayedGeoLocation(r,"setCenter",p)}break;case"polygon":r=new google.maps.Polygon(e);break;case"polyline":r=new google.maps.Polyline(e);break;case"rectangle":e.bounds&&(e.bounds=n(e.bounds)),r=new google.maps.Rectangle(e);break;case"groundOverlay":case"image":var c=e.url,l=n(e.bounds),u={opacity:e.opacity,clickable:e.clickable,id:e.id};r=new google.maps.GroundOverlay(c,l,u)}for(var g in o)o[g]&&google.maps.event.addListener(r,g,o[g]);return r};return{restrict:"E",require:"^map",link:function(e,n,r,i){var a=t.orgAttributes(n),s=t.filter(r),p=t.getOptions(s),c=t.getEvents(e,s),l=o(p,c);i.addShape(l),t.observeAttrSetObj(a,r,l)}}}]),ngMap.directive("trafficLayer",["Attr2Options",function(e){var t=e,n=function(e,t){var n=new google.maps.TrafficLayer(e);for(var o in t)google.maps.event.addListener(n,o,t[o]);return n};return{restrict:"E",require:"^map",link:function(e,o,r,i){var a=t.orgAttributes(o),s=t.filter(r),p=t.getOptions(s),c=t.getEvents(e,s),l=n(p,c);i.addObject("trafficLayers",l),t.observeAttrSetObj(a,r,l)}}}]),ngMap.directive("transitLayer",["Attr2Options",function(e){var t=e,n=function(e,t){var n=new google.maps.TransitLayer(e);for(var o in t)google.maps.event.addListener(n,o,t[o]);return n};return{restrict:"E",require:"^map",link:function(e,o,r,i){var a=t.orgAttributes(o),s=t.filter(r),p=t.getOptions(s),c=t.getEvents(e,s),l=n(p,c);i.addObject("transitLayers",l),t.observeAttrSetObj(a,r,l)}}}]),ngMap.directive("weatherLayer",["Attr2Options",function(e){var t=e,n=function(e,t){var n=new google.maps.weather.WeatherLayer(e);for(var o in t)google.maps.event.addListener(n,o,t[o]);return n};return{restrict:"E",require:"^map",link:function(e,o,r,i){var a=t.orgAttributes(o),s=t.filter(r),p=t.getOptions(s),c=t.getEvents(e,s),l=n(p,c);i.addObject("weatherLayers",l),t.observeAttrSetObj(a,r,l)}}}]);